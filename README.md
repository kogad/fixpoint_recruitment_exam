# 実行方法

- 設問 1: `julia run.jl 1 ファイル名`
- 設問 2: `julia run.jl 2 ファイル名 N`
- 設問 3: `julia run.jl 3 ファイル名 N m t`
- 設問 4: `julia run.jl 4 ファイル名 N m t`

`julia tests.jl` でテストが動きます．

```
Test Summary: | Pass  Total
Q1            |    2      2
Test Summary: | Pass  Total
Q2            |    4      4
Test Summary: | Pass  Total
Q3            |    8      8
Test Summary: | Pass  Total
Q4            |   11     11
```

# 問題

各設問での実行方法とその結果を示します．
プログラムの詳細については，ソースコード中のコメントにて示しています．

## 設問 1

実行方法: `julia run.jl 1 test_Q1.txt`

実行結果:

```
192.168.1.2 : 2020-10-19T13:32:30 - 2020-10-19T13:32:35
10.20.30.1 : 2020-10-19T13:33:24 - 2020-10-19T13:33:29
192.168.1.1 : 2020-10-19T13:32:34 - 2020-10-19T13:33:33
```

監視ログを 1 行ずつ確認し，

- サーバーがタイムアウトしていれば故障とみなす
- 正常に応答しているが直近のログで故障していたら復帰したとみなし故障期間を表示する

## 設問 2

実行方法: `julia run.jl 2 test_Q2.txt 3`

実行結果:

```
10.20.30.1 : 2020-11-19T13:33:24 - 2020-11-19T13:33:27
192.168.1.1 : 2020-11-19T13:35:10 - 2020-11-19T13:35:40
10.20.30.1 : 2020-11-19T13:35:25 - 2020-11-19T13:35:55
```

監視ログを 1 行ずつ確認し，

- サーバーが`N`回連続タイムアウトしていれば故障とみなす
- 正常に応答しているが直近のログで故障していた場合，復帰したとみなし故障期間を表示する

## 設問 3

実行方法: `julia run.jl 3 test_Q3.txt 3 3 49`

実行結果:

```
[overloaded] 10.20.30.2 : 2020-10-19T13:32:25 - 2020-10-19T13:33:26
[overloaded] 192.168.1.1 : 2020-10-20T13:00:20 - 2020-10-20T13:00:50
[overloaded] 10.20.30.1 : 2020-10-20T13:00:35 - 2020-11-19T13:33:26
[down]       10.20.30.1 : 2020-11-19T13:33:24 - 2020-11-19T13:33:27
[overloaded] 192.168.1.1 : 2020-10-21T13:00:30 - 2020-11-19T13:34:20
[down]       192.168.1.1 : 2020-11-19T13:35:10 - 2020-11-19T13:35:40
[down]       10.20.30.1 : 2020-11-19T13:35:25 - 2020-11-19T13:35:55
```

監視ログを 1 行ずつ確認し， - 連続タイムアウトのカウント・応答時間を記録 - サーバーの故障・負荷状態の遷移 - 故障・過負荷の期間を出力
を行う.

過負荷の期間は，応答時間の平均が t を超えた時点から，t 以下になるまでとする．

過負荷かどうかの判定ではタイムアウトを無視する． - 平均応答時間の計算時には，タイムアウトしたログは読み飛ばして，直近のタイムアウトしていない `m` 個のログを用いる

過負荷かつ故障している状態は考えない．過負荷状態でタイムアウトが連続したら故障とみなす．過負荷 → 故障となり，故障から復帰した場合は過負荷状態ではないとする．

# 設問 4

実行方法: `julia run.jl 4 test_Q4.txt 3 3 49`

実行結果:

```
[overloaded]   10.20.30.2 : 2020-10-19T13:32:25 - 2020-10-19T13:33:26
[overloaded]   192.168.1.1 : 2020-10-20T13:00:20 - 2020-10-20T13:00:50
[overloaded]   10.20.30.1 : 2020-10-20T13:00:35 - 2020-11-19T13:33:26
[down]         10.20.30.1 : 2020-11-19T13:33:24 - 2020-11-19T13:33:27
[overloaded]   192.168.1.1 : 2020-10-21T13:00:30 - 2020-11-19T13:34:20
[down]         10.20.30.2 : 2020-11-19T13:35:36 - 2020-11-19T13:35:39
[down(subnet)] 10.20.0.0 : 2020-11-19T13:35:25 - 2020-11-19T13:35:39
[down]         192.168.1.1 : 2020-11-19T13:35:10 - 2020-11-19T13:35:40
[down]         10.20.30.1 : 2020-11-19T13:35:25 - 2020-11-19T13:35:55
[overloaded]   10.20.30.1 : 2020-12-19T13:32:24 - 2020-12-19T14:35:35
[down]         192.168.1.1 : 2020-12-19T14:35:10 - 2020-12-19T14:41:20
[down(subnet)] 192.168.1.0 : 2020-12-19T14:35:10 - 2020-12-19T14:41:20
[down]         192.168.1.2 : 2020-12-19T14:40:40 - 2020-12-19T14:41:30
[down]         10.20.30.1 : 2020-12-19T14:35:25 - 2020-12-19T14:41:40
[down(subnet)] 10.20.0.0 : 2020-12-19T14:35:25 - 2020-12-19T14:41:40
[down]         10.20.30.2 : 2020-12-19T14:35:36 - 2020-12-19T14:41:50
```

サブネットに関する処理以外は，設問 3 と同様．

1 つのサブネットに属するサーバーが全て故障したら，サブネットの故障とみなす．

サブネットの故障期間は，そのサブネット内で最初に故障したサーバーの故障時刻から，サブネットないのいずれかのサーバーが復活した時刻までとする．

1 つのサーバーが故障するたびにサブネットの故障判定を行い，1 つのサーバーが復活するたびにサブネットの復活判定を行う．
